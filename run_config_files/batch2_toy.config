set -Eeuo pipefail # https://stackoverflow.com/a/821419

#-----------------------------
# To run this:
#  1. `git clone git@gitlab.oit.duke.edu:granek-lab/projects/dorado-pipelines.git`
#  2. `dorado-pipelines/basecall_demux_map/main_sbatch.sh PATH_TO_THIS_CONFIG`

#-----------------------------
export DORADO_SIF_PATH='docker://nanoporetech/dorado:sha0fe401d8dfb4739b6904a57392ba2566d086d180' # dorado version 1.0.2+c758d2f6
export POD5_SIF_PATH='oras://gitlab-registry.oit.duke.edu/granek-lab/granek-container-images/meta-methylome-simage:v002'
# srun -A chsi -p chsi      --mem=20G -c 10 apptainer exec $DORADO_SIF_PATH dorado --version
# srun -A chsi -p chsi      --mem=20G -c 10 apptainer exec $MODKIT_SIF modkit --version
#-----------------------------
#-----------------------------
export CPUJOB_PARTITION="chsi,common,scavenger"
export GPUJOB_PARTITION="biostat-gpu,gpu-common,scavenger-gpu"
export GPU_ACCOUNT="biostat"
export CPU_ACCOUNT="chsi"

export GPUJOB_GPUS="5000_ada"
#-----------------------------
SCRATCH_DIR="/cwork/${USER}"
export FAST_LOCAL_STORAGE="/scratch"

# generated by make_combined_mb_lambda_genome.sh
export REFERENCE_GENOME="${SCRATCH_DIR}/genomes/mb_lambda_fusion/Mbrunneum4556_phage_lambda.fna.gz"

export OUTDIR="${SCRATCH_DIR}/toy_results/bsf_batch2_toy"
export POD5_DIR="/cwork/josh/toypod5_sets/20250722_BSF_batch2_toy/BSF_Batch2"

#-----------------------------
# dorado duplex will fail if a requested model is not available for your dataset (e.g. 6mA)
# find model names with: 
# srun --mem=20G -c 2 -A chsi -p chsi apptainer exec oras://gitlab-registry.oit.duke.edu/granek-lab/granek-container-images/dorado-simg:v0_6_1 dorado download --list
# dorado won't do 4mC_5mC and 5mC_5hmC simultaneously
# export DORADO_MODEL_STRING="sup,5mC_5hmC,6mA"
export DORADO_MODEL_STRING="sup,4mC_5mC,6mA"
#-----------------------------
# find demux information with: 
# srun --mem=5G -c 2 -A chsi -p chsi apptainer exec oras://gitlab-registry.oit.duke.edu/granek-lab/granek-container-images/dorado-simg:v0_6_1 dorado demux --help
export KIT_NAME="SQK-NBD114-96" # for options run see --kit-name in `dorado demux --help`

#--------------
## Sample Sheet
#--------------
export SAMPLE_SHEET="/cwork/josh/toypod5_sets/20250722_BSF_batch2_toy/20250722_BSF_batch2_sample_sheet_expanded.csv"
